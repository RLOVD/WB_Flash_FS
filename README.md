# WB_Flash_FS


## Описание функций.

Функция записи файла, в качестве параметов принимает идентификатор, указатель на массив записываемых данных,размер.

uint8_t File_Write(uint16_t id_file, uint32_t *w_file, uint16_t size);

Функция чтения файла, в качестве параметов принимает идентификатор, указатель на массив для прочитанных данных,размер .

uint8_t File_Read(uint16_t id_file, uint32_t *r_file, uint16_t size);

Функция удаления файла, в качестве параметра принимает идентификатор.

void File_Delete(uint16_t id_file);

В свободное процессорное время вызывается функция для стирания страниц памяти с удаленными файлами
Clear_file_process(Servise_info_Tpf *clr_file); В качестве параметра передается структура clr_file;

## Описание реализации библиотеки Flash_FS.

В свободное процессорное время после записи очередного файла должна вызываться функция Clear_file_process 
в которую передается структура содержащая идентификатор файла и номер его  для стирания страницы с предыдущей версией файла. 
Версия файла была введена дополнительно для распознавания и предотвращения случайного удаления функцией Clear_file_process новой  версии файла.

В конец страницы с файлом записывается идентификатор  число uint16_t а также номер версия файла uint16_t.
При записи файл записывается на новое свободное место если даже если такой файл присутствует, и у нового файла увеличивается значение версии.
Таким образом новая версия файла записывается на новое свободное место, и вслучае его частого удаления и записи исключен износ конкретных адресов памяти нежели например при использовании жестких адресов для файлов.

Данная реализация также гарантирует что если во время записи произойдет сбой питания, то предыдущий файл останется т.к. 
не успеет записаться новый идентификатор (потому что он записывается в конце) и таким образом функция поиска файла его не обнаружит.

Также выполяется требование по быстродействию, когда операция стирания  выполняется отдельно когда процессор не занят.

Равномерный износ флеш гарантируется реализованным алгоритмом последовательной записи от стартовой области памяти до окончательной. 
В глобальной переменной uint32_t head_adr хранится текущий адрес начала поиска свободного места. 
Как только ее значение будет равно адресу конца заданной области,
то это значение вновь инициализируется начальным адресом и функция Find_Clear_Page вернет адрес первой чистой страницы в заданной области, доступной после удаления файла.

